# Maze Servo Controller

A Raspberry Pi project that reads a binary maze file, allows joystick navigation of a player inside the maze, and controls two servos to aim based on the player's position.



## Overview

This project loads a maze from a `.bin` file generated by the [maze-generator](https://github.com/viliarija/maze-generator). It lets you control a player inside the maze using a joystick connected via an MCP3008 ADC. The player moves inside maze cells and responds to walls.

Player coordinates are converted to angles, which are then used to drive two servos in pan and tilt configuration. The project runs on Raspberry Pi using `pigpio` for servo control and reads joystick input from MCP3008.



## Features

* Load maze from binary `.bin` file with maze dimensions and cell data
* Player movement constrained by maze walls and boundaries
* Joystick input reading via MCP3008 ADC
* Real-time servo control to point servos based on player position
* Calibration and reset functionality
* Smooth frame timing targeting 60 FPS
* Debug mode with detailed joystick and servo info output



## Hardware Requirements

* Raspberry Pi (tested with Pi 4)
* Two servo motors connected to GPIO pins
* A lazer pointer module (used to display the player on the maze)
* MCP3008 ADC connected via SPI for joystick analog input
* Analog joystick connected to MCP3008 channels 0 and 1
* Power supply capable of running servos reliably



## Software Requirements

* C++17 compatible compiler
* `pigpio` library installed (`sudo apt install pigpio`)
* Maze generator to produce `.bin` maze files (see linked repo)



## Getting Started

1. **Build**

   Clone the repo along with dependencies:

   ```bash
   git clone --recurse-submodules https://github.com/viliarija/raspberry-laser-turret-maze
   cd raspberry-laser-turret-maze
   ```

   Run the `build.sh` script:

   ```bash
   chmod +x build.sh
   ./build.sh
   ```

2. **Generate Maze**

   Use [maze-generator](https://github.com/viliarija/maze-generator) to create a maze binary file `maze.bin`.

3. **Prepare settings**

   Modify the default settings in `settings.csv` to your use case:

   ```
   MAZE_WIDTH,
   MAZE_HEIGHT,
   CELL_SIZE,
   PLAYER_SPEED,
   PLANE_WIDTH_CM,
   PLANE_HEIGHT_CM,
   DISTANCE_CM,
   MIN_PULSE,
   MAX_PULSE,
   MAX_ANGLE,
   OFFSET_X,
   OFFSET_Y,
   ```

NOTE: do not forget to change maze dimensions to match the generated bin!

4. **Run**

   ```bash
   sudo ./main
   ```


## Usage

When initialized the program accepts the following commands
* **PAUSE** - pauses servo movement
* **DEBUG** - prints the servo angle, PWM signal value, joystick values and player coordinates
* **CALIB** - traces along the contours of the maze (helps with calibration)
* **RESET** - resets player position to cell 1:1
* **QUIT**  - safely quits the program


## Code Structure

* **src/game.cpp / game.h** — Maze loading, player movement, collision detection
* **src/servo.cpp / servo.h** — Servo control wrapper using `pigpio` and threading
* **src/main.cpp** — Main loop, joystick reading, servo positioning, settings loading


## Notes

* Ensure `pigpio` daemon is running (`sudo pigpiod`).
* Adjust servo GPIO pins and MCP3008 channel assignments as needed.
* The maze binary format stores width, height, followed by cell data bytes.



## License

MIT License
